<!-- get timeline here, full timeline-->

<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, maximum-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

    <link href="../assets/img/mylogo2.png" rel="icon">
		<title>TwitterDiaries - Tweets</title>
    
        <!-- Custom fonts for this template-->
        <link href="../css/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    
        <!-- Custom styles for this template-->
        <link href="../css/sb-admin-2.css" rel="stylesheet">

	</head>

  <% if (user.theme == "checked") { %>
    <body id="page-top" class="dark">
  <% } else { %>
	  <body id="page-top">
  <% } %>

      <!-- <div> 
        <%= user.username %>
        <%= user.overallSentiment %>
      </div> -->
        <!-- Page Wrapper -->
        <div id="wrapper">

            <!-- Sidebar -->
            <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark toggled">

                <!-- Home Logo -->
                <a class="sidebar-brand d-flex align-items-center justify-content-center" href="/main">
                  <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa">
                      <img src="../assets/img/mylogo3.png">
                    </i>
                  </div>
                  <div class="sidebar-brand-text mx-3">TwitterDiaries</div>
                </a>
      
                <!-- Divider -->
                <hr class="sidebar-divider">
      
                <!-- Heading -->
                <div class="sidebar-heading">
                  Twitter Account Analytics
                </div>
      
                <!-- Home page -->
                <li class="nav-item active">
                  <a class="nav-link" href="/main">
                    <i class="fa fa-desktop"></i>              
                    <span>Dashboard</span></a>
                </li>
      
                <!-- Divider -->
                <!-- <hr class="sidebar-divider my-0"> -->
      
                <!-- Full Timeline-->
                <li class="nav-item active">
                  <a class="nav-link" href="/profile/timeline">
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-card-list mr-1" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" d="M14.5 3h-13a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                      <path fill-rule="evenodd" d="M5 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 5 8zm0-2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5z"/>
                      <circle cx="3.5" cy="5.5" r=".5"/>
                      <circle cx="3.5" cy="8" r=".5"/>
                      <circle cx="3.5" cy="10.5" r=".5"/>
                    </svg>
                    <span>Full Tweet Timeline</span></a>
                </li>
      
                <!-- Divider -->
                <hr class="sidebar-divider">
      
                <!-- Heading -->
                <div class="sidebar-heading">
                  Others
                </div>
      
                <!-- Profile page ++ Settings (can access via top right oso upon click on etc part in drop down)-->
                <li class="nav-item">
                  <a class="nav-link" href="/profile">
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-person-circle mr-1" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                      <path d="M13.468 12.37C12.758 11.226 11.195 10 8 10s-4.757 1.225-5.468 2.37A6.987 6.987 0 0 0 8 15a6.987 6.987 0 0 0 5.468-2.63z"/>
                      <path fill-rule="evenodd" d="M8 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                      <path fill-rule="evenodd" d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z"/>
                    </svg>
                    <span>Profile</span>
                  </a>
                </li>
      
                <!-- About Us page -->
                <li class="nav-item">
                  <a class="nav-link" href="/app">
                    <i class="fas fa-fw fa-table"></i>
                    <span>About Us</span>
                  </a>
                </li>
      
      
                <!-- Login or Logout -->
                <% if (user) { %>
                <!-- inner join this file-->
                <li class="nav-item">
                  <a class="nav-link" href="/auth/logout">
                    <i class="fa fa-sign-out-alt"></i>
                    <span>Logout</span>
                  </a>
                </li>
                <% } else { %>
                <li class="nav-item">
                  <a class="nav-link" href="/auth/twitter">
                    <i class="fas fa-fw fa-table"></i>
                    <span>Login</span>
                  </a>
                </li>
                <% } %>
      
                <!-- can insert the toggle dark mode here -->
      
      
                <hr class="sidebar-divider d-none d-md-block">
      
                <!-- Sidebar Toggler (Sidebar) -->
                <!-- <div class="text-center d-none d-md-inline">
                  <button class="rounded-circle border-0" id="sidebarToggle"></button>
                </div> -->
      
              </ul>
              <!-- End of Sidebar -->

              <!-- Main Content-->
              <div id="content-wrapper" class="d-flex flex-column">
                <!-- Main Content -->

                <div id="content">

                  <!-- Topbar -->
                  <% if (user && user.theme == "checked") { %>
                    <nav class="navbar navbar-expand navbar-light topbar mb-4 static-top shadow dark">
                    <% } else { %> 
                    <nav class="navbar navbar-expand navbar-light topbar mb-4 static-top shadow ">
                    <% } %>
                      <!-- Topbar Navbar -->
                      <ul class="navbar-nav ml-auto">
        
                        <!-- Nav Item - Search Dropdown (Visible Only XS) -->
                        <% if (user) { %>
                        <!-- Nav Item - User Information -->
                        <li class="nav-item dropdown no-arrow">
                          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
        
                            <span class="mr-2 d-none d-lg-inline text-gray-600 small">
                              <%= user.username %>
                            </span>
                            <img class="img-profile rounded-circle" src="<%= user.profileImage %>" alt="profileImage">
        
                          </a>
        
                          <!-- Dropdown - User Information -->
                          <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                            aria-labelledby="userDropdown">
                            <a class="dropdown-item" href="/profile">
                              <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                              Profile
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="/main">
                              <i class="fas fa-desktop fa-sm fa-fw mr-2 text-gray-400"></i>
                              Dashboard
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="/profile/timeline">
                              <i class="fas fa-desktop fa-sm fa-fw mr-2 text-gray-400"></i>
                              Timeline
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="/auth/logout">
                              <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                              Logout
                            </a>
                          </div>
                          <% } %>
                        </li>
        
                      </ul>
        
                    </nav>
                  <!-- End of Topbar -->

                  <!-- Begin Page Content -->
                  <div class="container-fluid">

                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                      <% if (user && user.theme == "checked") { %>
                      <h1 class="h3 mb-0 text-gray-300">Full Tweet Timeline</h1>
                      <% } else { %> 
                        <h1 class="h3 mb-0 text-gray-800">Full Tweet Timeline</h1>
                      <% } %>

                    </div>

                    <div class="row"></div>

                    <!-- Get Timeline card --> <!-- if user first time log in -->



                    <!-- <div class="col-xl-12 mb-4">
                        <% if (user.theme == "checked") { %>
                        <div class="card shadow mb-4 h-100 dark">
                        <% } else { %>
                        <div class="card shadow mb-4 h-100">
                        <% } %>
                            <div class="card-body h-100 d-flex flex-column justify-content-center py-5 py-xl-4">
                                <div class="row align-items-center">
                                    <div class="col-xl">
                                        <div class="text-center px-4 mb-4 mb-xl-0">
                                            <h1 class="text-primary">Get Timeline</h1> !
                                            <p class="text-gray-700 mb-0">
                                                Press the above button to get your full timeline!!
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div> -->
                   
                    <!-- Welcome Timeline card --> <!-- subsequent user log in -->
                    <div id='tweet'>
                      <!--Added this card to wrap each tweet -->

                      <% 
                      var latestList = timeline[0][0].date.split(" ");
                      var latest_mth = latestList[1]
                      var latest_day = latestList[2]
                      var latest_year = latestList[5]
                      
                      earliestindex = timeline.length -1 
                      var earliestList = timeline[earliestindex][0].date.split(" ");
                      var earliest_mth = earliestList[1]
                      var earliest_day = earliestList[2]
                      var earliest_year = earliestList[5]
                      
                      %>
                    </div>
                    <div class="col-xl-12 mb-4">
                        <% if (user.theme == "checked") { %>
                          <div class="card shadow mb-4 h-100 dark">
                          <% } else { %>
                          <div class="card shadow mb-4 h-100">
                          <% } %>
                            <div class="card-body h-100 d-flex flex-column justify-content-center py-5 py-xl-4">
                                <div class="row align-items-center">
                                    <div class="col-xl">
                                        <div class="text-center px-4 mb-4 mb-xl-0">
                                            <h1 class="text-primary">Welcome to Your Timeline, <%= user.username %></h1> <!-- should be a button-->
                                            <% if (user && user.theme == "checked") { %>
                                            <p class="text-gray-300 mb-0" >
                                            <% } else { %> 
                                              <p class="text-gray-700 mb-0" >
                                            <% } %>
                                                <b> Total Number of Tweets:</b> <%= timeline.length; %><br>
                                                <b> Earliest Tweet Date:</b> <%= earliest_day %> <%=earliest_mth; %> <%= earliest_year %><br>
                                                <b> Latest Tweet Date:</b> <%= latest_day %> <%=latest_mth; %> <%= latest_year %>
                                                <%  tweet[0].analysis["year"] = [earliest_year, latest_year];  %>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Card for all the timeline tweets -->

                    <div class="col-xl-12 mb-4">

                        <% if (user.theme == "checked") { %>
                          <div class="card shadow mb-4 h-100 dark">
                          <% } else { %>
                          <div class="card shadow mb-4 h-100">
                          <% } %>                            
                          <div class="card-body h-100 d-flex flex-column justify-content-center py-5 py-xl-4">
                                <div class="row align-items-center">
                                    <div class="col-xl">
                                        <div class="text-center px-4 mb-4 mb-xl-0">
                                            <!-- tweets here-->
                                            <div id='tweet'>
                                              <!--Added this card to wrap each tweet -->
                                              <% 
                                              <!-- Count the number of positive, neutral and negative tweets -->
                                              var numOfEmotionAnalysis = {"Neutral":0,"Positive":0,"Negative":0};

                                              <!-- Loop to get all tweet text, time, analyzed sentiment -->
                                              for(tweet of timeline){
                                                var tweetTimeStr =  tweet[0].date;
                                                var actualTweetTime = new Date(tweetTimeStr);
                                                var tweetTimeInfo = actualTweetTime.toString().split(" ");
                                                var tweetMonth = tweetTimeInfo[1];
                                                var tweetyear = tweetTimeInfo[3];
                                              %>
                                        
                                              <div class="col" style="padding: 0;">
                                                <div class="card">
                                                  <% var tweetPolarity = tweet[0].analysis.polarity;

                                                  <!-- Caps the emotion (e.g. "positive" becomes "Positive") -->
                                                  var tweetPolarityCaps = tweetPolarity.charAt(0).toUpperCase() + tweetPolarity.slice(1);

                                                  <!-- If the emotion is already in the object, add 1 to the count -->
                                                  if (tweetPolarityCaps in numOfEmotionAnalysis){
                                                    numOfEmotionAnalysis[tweetPolarityCaps] += 1;
                                                  }

                                                  <!-- otherwise, create a new key for the emotion -->

                                                  
                                                  if(tweetPolarity == "positive") {%>
                                                  <div class="card-header text-white bg-success mb-3">
                                                    <% } else if(tweetPolarity == "neutral") {%>
                                                    <div class="card-header text-white bg-secondary mb-3">
                                                      <% } else {%>

                                                      <div class="card-header text-white bg-danger mb-3">
                                                        <% } %>
                                                        Tweet Polarity is: <%= tweetPolarityCaps %>
                                                      </div>
                                        
                                                      <div class="card-body">
                                                        <h5 class="card-title"> "<%= tweet[0].text%>"</h5>
                                        
                                        
                                                        <br>
                                                        <!-- if there is an image it will be added here feel free to style it  -->
                                                        <% if('image' in tweet[0]) { %>
                                                        <img src="<%= tweet[0].image%>" width= 100% />
                                                        <% } %>
                                        
                                                        <p class="card-text">
                                                          <span>
                                                            Tweeted on: <%= actualTweetTime %>
                                                          </span>
                                                        </p>
                                                      </div>
                                                    </div>
                                                  </div>
                                        
                                                  <hr />
                                                  <% }
                                                    tweet[0].analysis["numOfEmotionAnalysis"] = numOfEmotionAnalysis; 
                                                  %>
                                                  
                                                </div>
                                              </div>
                                            <!-- inside here the tweets can stack accordingly maybe 2 per row-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Footer -->
          <footer class="sticky-footer">
              <div class="container my-auto">
                <div class="copyright text-center my-auto">
                  <span>Copyright &copy; TwitterDiaries' TwitterDiaries</span>
                </div>
              </div>
            </footer>
            <!-- End of Footer -->
                            </div>
                        </div>
                      </div>
                  </div>
                  <a class="scroll-to-top rounded" href="#page-top">
                      <i class="fas fa-angle-up"></i>
                    </a>
      <!-- Bootstrap core JavaScript-->
      <script src="/css/vendor/jquery/jquery.min.js"></script>
      <script src="/css/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

      <!-- Core plugin JavaScript-->
      <script src="/css/vendor/jquery-easing/jquery.easing.min.js"></script>

      <!-- Custom scripts for all pages-->
      <script src="/js/sb-admin-2.min.js"></script>

      <!-- Page level plugins -->
      <script src="/css/vendor/chart.js/Chart.min.js"></script>

      <!-- Page level custom scripts -->
      <script src="/js/demo/chart-area-demo.js"></script>
      <script src="/js/demo/chart-pie-demo.js"></script>

    </body>
    
</html>